\section{Постановка задачи}
\label{sec1}
Рассмотрим датасет для задачи детекции:
\[
\mathcal{D} = \bigl\{(x_i, t_i)\bigr\}_{i=1}^n,
\]
$x_i \in X$ — входное изображение, $X$ — пространство входных изображений
$t_i \in T$ — соответствующая аннотация, $T$ — пространство соответствующих аннотаций, содержащих координаты ограничивающих рамок и классы объектов

Рассмотрим модели детекции YOLO\cite{DBLP:journals/corr/RedmonDGF15}, DETR\cite{DBLP:journals/corr/abs-2005-12872} как отображения $f_{\theta}$,  $g_{\phi}$ :
\[
f_{\theta}: X \to \hat{T}, \  \ g_{\phi}: X \to \hat{T},
\]

$\hat{T}$ — пространство соответствующих аннотаций, содержащих координаты ограничивающих рамок и классы объектов, предсказанных моделью.

Определим функцию потерь для модели детекции $f_{\theta}$:
\begin{align*}
\mathcal{L}_{YOLO}(\theta) &= \lambda_{\text{coord}} \sum_{i=1}^{S^2} \sum_{j=1}^{B} \textbf{I}_{ij}^{\text{obj}} 
\left[ (x^{gt}_i - \hat{x}_i)^2 + (y^{gt}_i - \hat{y}_i)^2 \right] \notag \\
&+ \lambda_{\text{coord}} \sum_{i=1}^{S^2} \sum_{j=1}^{B} \textbf{I}_{ij}^{\text{obj}} 
\left[ (\sqrt{w^{gt}_i} - \sqrt{\hat{w}_i})^2 + (\sqrt{h^{gt}_i} - \sqrt{\hat{h}_i})^2 \right] \notag \\
&+ \sum_{i=1}^{S^2} \sum_{j=1}^{B} \textbf{I}_{ij}^{\text{obj}} (\hat{C}_i - C_i)^2 
+ \lambda_{\text{noobj}} \sum_{i=1}^{S^2} \sum_{j=1}^{B} \textbf{I}_{ij}^{\text{noobj}} (\hat{C}_i - C_i)^2 \notag \\
&+ \sum_{i=1}^{S^2} \textbf{I}_{i}^{\text{obj}} \sum_{c \in \mathcal{C}} (\hat{p}_i(c) - p_i(c))^2,
\end{align*}

где 
$S \times S$ — размер сетки, на которую разбивается изображение, $B$ — количество предсказанных ограничивающих рамок (bounding boxes) в каждой ячейке сетки,  
$\lambda_{\text{coord}}, \lambda_{\text{noobj}}$ — коэффициенты, регулирующие вклад  в функцию потерь,
$\textbf{I}_{ij}^{\text{obj}}$ — индикатор наличия объекта в $j$-й рамке $i$-й ячейки,  
$\textbf{I}_{ij}^{\text{noobj}}$ — индикатор отсутствия объекта в $j$-й рамке $i$-й ячейки,  
$(x^{gt}_i, y^{gt}_i, w^{gt}_i, h^{gt}_i)$ — координаты центра, ширина и высота истинного ограничивающего прямоугольника,  
$(\hat{x}_i, \hat{y}_i, \hat{w}_i, \hat{h}_i)$ — предсказанные координаты ограничивающего прямоугольника,  
$C_i$ и $\hat{C}_i$ — истинная и предсказанная вероятность наличия объекта в ячейке,  \(\mathcal{C}\) — множество классов объектов,
$p_i(c)$ и $\hat{p}_i(c)$ — истинная и предсказанная вероятность принадлежности объекта классу $c$.

Определим функцию потерь для модели детекции $g_{\phi}$:
\begin{align*}
\mathcal{L}_{DETR}(\phi)
&=  
   \sum_{i=1}^M \Bigl[
     -\log \hat p_{\sigma(i)}(c_i)
     + \lambda_{\ell_1}\,\|b_i - \hat b_{\sigma(i)}\|_1 
     + \lambda_{\mathrm{giou}}\,(1 - \mathrm{GIoU}(b_i, \hat b_{\sigma(i)}))
   \Bigr] \notag \\
&\quad
+ \sum_{j\,\in\,[N]\setminus\sigma([M])}
  \Bigl[-\log \hat p_j(c_{\varnothing})\Bigr],
\end{align*}

где $M$~--- количество объектов в разметке (ground truth), $N$~--- фиксированное количество предсказаний, выдаваемых моделью, $\hat{p}_j(c)$~--- вероятность, с которой $j$-е предсказание относится к классу $c$, $b_i$~--- ограничивающая рамка (bounding box) $i$-го объекта в разметке,
  $\hat{b}_j$~--- предсказанная моделью рамка для $j$-го объекта,
  $c_i$~--- истинная метка класса $i$-го объекта,
  $c_{\varnothing}$~--- специальный "пустой" класс (фон, no-object), обозначающий отсутствие объекта,
  $\mathfrak{S}_N$~--- множество всех перестановок $\{1, 2, \dots, N\}$, используемое для поиска наилучшего сопоставления предсказаний с размеченными объектами,
  $\sigma \in \mathfrak{S}_N$~--- конкретная перестановка, сопоставляющая предсказания $\hat{b}_{\sigma(i)}$ объектам $b_i$.
  $\lambda_{\ell_1}$~--- вес для L1-компоненты ошибки по координатам рамки,
  $\lambda_{\mathrm{giou}}$~--- вес для компоненты ошибки на основе обобщённого IoU,
  $\mathrm{GIoU}(b_i, \hat{b}_{\sigma(i)})$~--- метрика Generalized Intersection-over-Union, измеряющая степень совпадения рамок $b_i$ и $\hat{b}_{\sigma(i)}$.

  Решаются следующие оптимизационные задачи:

\[
\theta^* \;=\; \arg\min_{\theta} \mathcal{L}_{YOLO}(\theta), \ \ \phi^* \;=\; \arg\min_{\phi} \mathcal{L}_{DETR}(\phi), 
\]







